!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase,t.firebase.INTERNAL.modularAPIs)}(this,(function(t,e){"use strict";try{(function(){var n,r,a=(r=t)&&"object"==typeof r&&"default"in r?r:{default:r};class i extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,o.prototype.create)}}class o{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){var n,r=e[0]||{},a=`${this.service}/${t}`,o=(o=this.errors[t])?(n=r,o.replace(s,((t,e)=>{var r=n[e];return null!=r?String(r):`<${e}?>`}))):"Error";return o=`${this.serviceName}: ${o} (${a}).`,new i(a,o,r)}}const s=/\{\$([^}]+)}/g;class c{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const u=(t,e)=>e.some((e=>t instanceof e));let f,p;const d=new WeakMap,l=new WeakMap,g=new WeakMap,h=new WeakMap,v=new WeakMap;let w={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return l.get(t);if("objectStoreNames"===e)return t.objectStoreNames||g.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function m(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(p=p||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(t)?function(...e){return t.apply(b(this),e),y(d.get(this))}:function(...e){return y(t.apply(b(this),e))}:function(e,...n){var r=t.call(b(this),e,...n);return g.set(r,e.sort?e.sort():[e]),y(r)}}function y(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",a),t.removeEventListener("error",i)},a=()=>{e(y(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&d.set(e,t)})).catch((()=>{})),v.set(e,t),e}(t);if(h.has(t))return h.get(t);var e=function(t){return"function"==typeof t?m(t):(t instanceof IDBTransaction&&(e=t,l.has(e)||(n=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)})),l.set(e,n))),u(t,f=f||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(t,w):t);var e,n}(t);return e!==t&&(h.set(t,e),v.set(e,t)),e}const b=t=>v.get(t),I=["get","getKey","getAll","getAllKeys","count"],S=["put","add","delete","clear"],C=new Map;function T(t,e){if(t instanceof IDBDatabase&&!(e in t)&&"string"==typeof e){if(C.get(e))return C.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,a=S.includes(t);if(t in(r?IDBIndex:IDBObjectStore).prototype&&(a||I.includes(t))){var n=async function(e,...n){var i=this.transaction(e,a?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(n.shift())),(await Promise.all([o[t](...n),a&&i.done]))[0]};return C.set(e,n),n}}}w={...n=w,get:(t,e,r)=>T(t,e)||n.get(t,e,r),has:(t,e)=>!!T(t,e)||n.has(t,e)};var k="@firebase/installations",E="0.6.7";const j=1e4,D=`w:${E}`,P="FIS_v2",$="https://firebaseinstallations.googleapis.com/v1",B=36e5;var L;const q=new o("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function N(t){return t instanceof i&&t.code.includes("request-failed")}function O({projectId:t}){return`${$}/projects/${t}/installations`}function A(t){return{token:t.token,requestStatus:2,expiresIn:(t=t.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()}}async function M(t,e){var n=(await e.json()).error;return q.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function x({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function V(t,{refreshToken:e}){const n=x(t);return n.append("Authorization",`${P} ${e}`),n}async function _(t){var e=await t();return 500<=e.status&&e.status<600?t():e}function F(t){return new Promise((e=>{setTimeout(e,t)}))}const K=/^[cdef][\w-]{21}$/,H="";function R(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(t){const e=function(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}(t);return e.substr(0,22)}(e);return K.test(t)?t:H}catch(t){return H}}function W(t){return`${t.appName}!${t.appId}`}const z=new Map;function U(t,e){var n=W(t);J(n,e),function(t,e){const n=Y();n&&n.postMessage({key:t,fid:e}),Z()}(n,e)}function J(t,e){var n=z.get(t);if(n)for(const t of n)t(e)}let G=null;function Y(){return!G&&"BroadcastChannel"in self&&(G=new BroadcastChannel("[Firebase] FID Change"),G.onmessage=t=>{J(t.data.key,t.data.fid)}),G}function Z(){0===z.size&&G&&(G.close(),G=null)}const Q="firebase-installations-database",X=1,tt="firebase-installations-store";let et=null;function nt(){return et=et||function(t,e,{blocked:n,upgrade:r,blocking:a,terminated:i}){const o=indexedDB.open(t,e),s=y(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(y(o.result),t.oldVersion,t.newVersion,y(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),s.then((t=>{i&&t.addEventListener("close",(()=>i())),a&&t.addEventListener("versionchange",(t=>a(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),s}(Q,X,{upgrade:(t,e)=>{0===e&&t.createObjectStore(tt)}}),et}async function rt(t,e){var n=W(t);const r=(await nt()).transaction(tt,"readwrite"),a=r.objectStore(tt);var i=await a.get(n);return await a.put(e,n),await r.done,i&&i.fid===e.fid||U(t,e.fid),e}async function at(t){var e=W(t);const n=(await nt()).transaction(tt,"readwrite");await n.objectStore(tt).delete(e),await n.done}async function it(t,e){var n=W(t);const r=(await nt()).transaction(tt,"readwrite"),a=r.objectStore(tt);var i=await a.get(n),o=e(i);return void 0===o?await a.delete(n):await a.put(o,n),await r.done,!o||i&&i.fid===o.fid||U(t,o.fid),o}async function ot(t){let e;var n=await it(t.appConfig,(n=>{var r=ct(n||{fid:R(),registrationStatus:0});return r=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:async function(t){let e=await st(t.appConfig);for(;1===e.registrationStatus;)await F(100),e=await st(t.appConfig);if(0!==e.registrationStatus)return e;var{installationEntry:n,registrationPromise:r}=await ot(t);return r||n}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:r=Promise.reject(q.create("app-offline"))};var n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{var n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=O(t),a=x(t),i=e.getImmediate({optional:!0});!i||(o=await i.getHeartbeatsHeader())&&a.append("x-firebase-client",o);var o={fid:n,authVersion:P,appId:t.appId,sdkVersion:D};const s={method:"POST",headers:a,body:JSON.stringify(o)},c=await _((()=>fetch(r,s)));if(c.ok)return{fid:(o=await c.json()).fid||n,registrationStatus:2,refreshToken:o.refreshToken,authToken:A(o.authToken)};throw await M("Create Installation",c)}(t,e);return rt(t.appConfig,n)}catch(n){throw N(n)&&409===n.customData.serverCode?await at(t.appConfig):await rt(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}(t,r),e=r.registrationPromise,r.installationEntry}));return n.fid===H?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function st(t){return it(t,(t=>{if(!t)throw q.create("installation-not-found");return ct(t)}))}function ct(t){return 1===(e=t).registrationStatus&&e.registrationTime+j<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function ut(t,e=!1){let n;var r=await it(t.appConfig,(r=>{if(!pt(r))throw q.create("not-registered");var a,i=r.authToken;if(e||2!==(a=i).requestStatus||function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+B}(a)){if(1===i.requestStatus)return n=async function(t,e){let n=await ft(t.appConfig);for(;1===n.authToken.requestStatus;)await F(100),n=await ft(t.appConfig);var r=n.authToken;return 0===r.requestStatus?ut(t,e):r}(t,e),r;if(!navigator.onLine)throw q.create("app-offline");return a=r,i={requestStatus:1,requestTime:Date.now()},i=Object.assign(Object.assign({},a),{authToken:i}),n=async function(t,e){try{var n=await async function({appConfig:t,heartbeatServiceProvider:e},n){const r=([a,i]=[t,n.fid],`${O(a)}/${i}/authTokens:generate`);var a,i;const o=V(t,n),s=e.getImmediate({optional:!0});!s||(c=await s.getHeartbeatsHeader())&&o.append("x-firebase-client",c);var c={installation:{sdkVersion:D,appId:t.appId}};const u={method:"POST",headers:o,body:JSON.stringify(c)},f=await _((()=>fetch(r,u)));if(f.ok)return A(await f.json());throw await M("Generate Auth Token",f)}(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await rt(t.appConfig,r),n}catch(r){throw!N(r)||401!==r.customData.serverCode&&404!==r.customData.serverCode?(n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}),await rt(t.appConfig,n)):await at(t.appConfig),r}}(t,i),i}return r}));return n?await n:r.authToken}function ft(t){return it(t,(t=>{if(!pt(t))throw q.create("not-registered");var e;return 1===(e=t.authToken).requestStatus&&e.requestTime+j<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t}))}function pt(t){return void 0!==t&&2===t.registrationStatus}async function dt(t){var e=t;const{installationEntry:n,registrationPromise:r}=await ot(e);return(r||ut(e)).catch(console.error),n.fid}async function lt(t,e=!1){var n,r=t;return await((n=(await ot(r)).registrationPromise)&&await n),(await ut(r,e)).token}function gt(t){return q.create("missing-app-config-values",{valueName:t})}const ht="installations";e._registerComponent(new c(ht,(t=>{var n=t.getProvider("app").getImmediate();return{app:n,appConfig:function(t){if(!t||!t.options)throw gt("App Configuration");if(!t.name)throw gt("App Name");for(const e of["projectId","apiKey","appId"])if(!t.options[e])throw gt(e);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(n),heartbeatServiceProvider:e._getProvider(n,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),e._registerComponent(new c("installations-internal",(t=>{var n=t.getProvider("app").getImmediate();const r=e._getProvider(n,ht).getImmediate();return{getId:()=>dt(r),getToken:t=>lt(r,t)}}),"PRIVATE")),e.registerVersion(k,E),e.registerVersion(k,E,"esm2017");class vt{constructor(t,e){this.app=t,this._delegate=e}getId(){return dt(this._delegate)}getToken(t){return lt(this._delegate,t)}delete(){return async function(t){var e=t.appConfig,n=await it(e,(t=>{if(!t||0!==t.registrationStatus)return t}));if(n){if(1===n.registrationStatus)throw q.create("delete-pending-registration");if(2===n.registrationStatus){if(!navigator.onLine)throw q.create("app-offline");await async function(t,e){const n=([r,a]=[t,e.fid],`${O(r)}/${a}`);var r,a;const i={method:"DELETE",headers:V(t,e)};var o=await _((()=>fetch(n,i)));if(!o.ok)throw await M("Delete Installation",o)}(e,n),await at(e)}}}(this._delegate)}onIdChange(t){return function(t,e){const n=t.appConfig;return function(t,e){Y();var n=W(t);let r=z.get(n);r||(r=new Set,z.set(n,r)),r.add(e)}(n,e),()=>{!function(t,e){var n=W(t);const r=z.get(n);r&&(r.delete(e),0===r.size&&z.delete(n),Z())}(n,e)}}(this._delegate,t)}}(L=a.default).INTERNAL.registerComponent(new c("installations-compat",(t=>{var e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("installations").getImmediate();return new vt(e,n)}),"PUBLIC")),L.registerVersion("@firebase/installations-compat","0.2.7")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-installations-compat.js - be sure to load firebase-app.js first.")}}));